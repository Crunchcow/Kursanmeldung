{% extends 'courses/base.html' %}
{% load i18n %}
{% load crispy_forms_tags %}
{% load static %}

{% block title %}{% trans "Anmeldung für" %} {{ course.name }}{% endblock %}

{% block content %}
<div class="mb-3">
    <a href="{% url 'course_list' %}" class="btn btn-secondary">&larr; {% trans "Zurück zur Übersicht" %}</a>
</div>
<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card shadow-sm">
            <div class="card-header bg-primary text-white">
                <h4 class="mb-0">{% trans "Anmeldung für" %} {{ course.name }}</h4>
            </div>
            <div class="card-body">
                {% if error %}
                  <div class="alert alert-danger">{{ error }}</div>
                {% endif %}
                <div class="mb-3">
                    <div><strong>{% trans "Datum" %}:</strong> {{ course.start_date }} – {{ course.end_date }}</div>
                    <div><strong>{% trans "Uhrzeit" %}:</strong> {{ course.start_time }}–{{ course.end_time }}</div>
                    <div><strong>{% trans "Wochentage" %}:</strong> {% for d in course.days %}{{ d }}{% if not forloop.last %}, {% endif %}{% endfor %}</div>
                    <div><strong>{% trans "Einheiten" %}:</strong> {{ course.session_count }}</div>
                    <div><strong>{% trans "Preis Mitglied" %}:</strong> {{ course.price_member }}€</div>
                    <div><strong>{% trans "Preis Nicht-Mitglied" %}:</strong> {{ course.price_non_member }}€</div>
                </div>
                <form method="post" id="regform">
                    {% csrf_token %}
                    {{ form|crispy }}
                    <div id="price-summary" class="mt-2 alert alert-secondary" style="display:none;">
                        <p><strong>{% trans "Gewählter Preis" %}:</strong> <span id="selected-price">0</span>€</p>
                    </div>
                    <button type="submit" class="btn btn-primary">{% trans "Absenden" %}</button>
                </form>
            </div>
        </div>
    </div>
</div>
<script>
(function(){
    var memberCheckbox = document.getElementById('id_is_member');
    var halfCheckbox = document.getElementById('id_half_course');
    var priceMember = parseFloat('{{ course.price_member }}');
    var priceNon = parseFloat('{{ course.price_non_member }}');
    // sessions count no longer affects price
    function updatePrice(){
        var base = memberCheckbox.checked ? priceMember : priceNon;
        if(halfCheckbox.checked){ base = base/2; }
        document.getElementById('selected-price').textContent = base.toFixed(2);
        document.getElementById('price-summary').style.display = 'block';
    }
    memberCheckbox.addEventListener('change', updatePrice);
    halfCheckbox.addEventListener('change', updatePrice);
    // initial
    updatePrice();
})();
</script>
{% endblock %}